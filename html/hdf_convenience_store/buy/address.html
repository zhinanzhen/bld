<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>收货地址</title>
		<link rel="stylesheet" type="text/css" href="../css/base.css"/>
		<link rel="stylesheet" type="text/css" href="../css/iconfont.css"/>
		<link rel="stylesheet" type="text/css" href="../css/layout.css"/>
		<link rel="stylesheet" type="text/css" href="css/address.css"/>
		<link rel="stylesheet" type="text/css" href="../css/swiper-4.3.3.min.css"/>
		<script src="../js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/rem_ajax.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/swiper-4.3.3.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/children.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<body>
		<header class="heads">
			<i class="iconfont icon-guanbi" id="back"></i>
			<div>收货地址</div>
		</header>
		<section class="sets">
			<div class="all-address">
				<!--<div class="adds">
					<div>
						<div>收件人:</div>
						<div>魏雨 </div>
						<div> 176****8322</div>
					</div>
					<div>取货地址：<span>河南省郑州市中原区梧桐街道祝福红城南区</span></div>
					<div>
						<div class="defaults">
							<i class="iconfont icon-tubiao-xuanze"></i>设为默认地址
						</div>
						<div>
							<div class="editor">编辑</div>
							<div>删除</div>
						</div>
					</div>
				</div>
				<div class="adds">
					<div>
						<div>收件人:</div>
						<div>魏雨 </div>
						<div> 176****8322</div>
					</div>
					<div>取货地址：<span>河南省郑州市中原区梧桐街道祝福红城南区</span></div>
					<div>
						<div class="defaults">
							<i class="iconfont icon-xuanze-danxuan"></i>
							设为默认地址
						</div>
						<div>
							<div class="editor">编辑</div>
							<div>删除</div>
						</div>
					</div>
				</div>-->
			</div>
		</section>
		<footer>
			<div class="add-address">添加新地址</div>
		</footer>
<script type="text/javascript">
	$(function(){
		//设为默认地址
		$(".sets").on("click",".defaults",function(){
			
		});
		//编辑地址
		$(".sets").on("click",".editor",function(){
			window.location.href="add_address.html";
		});
		$(".add-address").click(function () {
            window.location.href='./add_address.html?orderId=' + getUrlString("orderId") + "&totalprice=" + getUrlString("totalprice");
        });
        initData();

        $("#back").click(function () {
            window.location.href='./order.html?orderId=' + getUrlString("orderId") + "&totalprice=" + getUrlString("totalprice");
        });

	});
	function initData() {
        ajaxs("api/receiver/list",'post',{},function(data){
            console.log(data);
            if(data.code == 0 && data.list){
                var html = "";
                for(var i in data.list){
                    html += obtainHtml(data.list[i]);
                }
                $(".all-address").html(html);
            }
        },function(err){
            console.log(err);
        });
    }
    function obtainHtml(address) {
        var html = '<div class="adds">                                            '
            + '	<div>                                                        '
            + '		<div>收件人:</div>                                       '
            + '		<div class="consignee">' + address.consignee + '</div>           '
            + '		<div class="phone">' + address.phone + '</div>                   '
            + '	</div>                                                       '
            + '	<div>取货地址：<span>' + address.areaName + address.address + '</span></div> '
            + '	<div>                                                        '
            + '		<div class="defaults">                                   ';
        if(!address.isDefault){
            html += '<i onclick="modidfyAddress(this)" class="iconfont icon-tubiao-xuanze"><span id="hiddenAddressId" hidden>' + address.id + '</span></i>设为默认地址';
        }else{
            html += '<i class="iconfont icon-xuanze-danxuan"></i>设为默认地址';
        }
        html += '		</div>                                                   '
            + '		<div>                                                    '
            + '			<div class="editor">编辑</div>                       '
            + '			<div>删除</div>                                      '
            + '		</div>                                                   '
            + '	</div>                                                       ';

        return html;
    }
    function modidfyAddress(obj) {
        var params = {id: $(obj).find("#hiddenAddressId").html(),isdefault:true};
        ajaxs("api/receiver/update",'post',JSON.stringify(params),function(data){
            console.log(data);
            if(data.code == 0){
                initData();
            }
        },function(err){
            console.log(err);
        },{contentType : 'application/json;charset=utf-8'});
    }
</script>
	</body>
</html>
